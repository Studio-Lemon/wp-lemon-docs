"use strict";(globalThis.webpackChunkwp_lemon_docs=globalThis.webpackChunkwp_lemon_docs||[]).push([[4099],{6918(e,t,n){n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"working-with-posts/extending-post-objects","title":"Extending post objects","description":"Extending post objects in wp-lemon","source":"@site/docs/working-with-posts/extending-post-objects.mdx","sourceDirName":"working-with-posts","slug":"/working-with-posts/extending-post-objects","permalink":"/wp-lemon-docs/working-with-posts/extending-post-objects","draft":false,"unlisted":false,"editUrl":"https://github.com/Studio-Lemon/wp-lemon-docs/tree/master/docs/working-with-posts/extending-post-objects.mdx","tags":[],"version":"current","frontMatter":{"title":"Extending post objects","description":"Extending post objects in wp-lemon"},"sidebar":"docsSidebar","previous":{"title":"Post type registration","permalink":"/wp-lemon-docs/working-with-posts/post-type-registration"},"next":{"title":"Using post objects","permalink":"/wp-lemon-docs/working-with-posts/using-post-objects"}}');var o=n(4848),i=n(8453);const l={title:"Extending post objects",description:"Extending post objects in wp-lemon"},r=void 0,a={},c=[{value:"Setting up",id:"setting-up",level:2},{value:"Create new file",id:"create-new-file",level:3},{value:"Add to classmap",id:"add-to-classmap",level:3},{value:"Include the file",id:"include-the-file",level:3},{value:"Examples",id:"examples",level:2},{value:"Example 1",id:"example-1",level:3},{value:"Example 2",id:"example-2",level:3},{value:"Wp-lemon queries",id:"wp-lemon-queries",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"In wp-lemon it's possible to extend the post objects to add functionality if needed.\nThis can be very useful when further customizing your site.\nLater on in this chapter we'll show you a couple of examples of how you can use this functionality."}),"\n",(0,o.jsx)(t.h2,{id:"setting-up",children:"Setting up"}),"\n",(0,o.jsx)(t.p,{children:"For the set-up you'll need to do the following:"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["Create a new file in the ",(0,o.jsx)(t.code,{children:"/library/classes/"})," directory with the pattern ",(0,o.jsx)(t.code,{children:"class-object-<post_type_name>.php"})," where ",(0,o.jsx)(t.code,{children:"post_type_name"})," is the name of your post type."]}),"\n",(0,o.jsx)(t.li,{children:"Add the new class to the classmap."}),"\n",(0,o.jsx)(t.li,{children:"Include the file in your functions file."}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"create-new-file",children:"Create new file"}),"\n",(0,o.jsxs)(t.p,{children:["Navigate to the ",(0,o.jsx)(t.code,{children:"/library/classes/"})," directory.\nHere you can create a new file that extends the ",(0,o.jsx)(t.code,{children:"LemonPost"})," class. This will look something like this:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"\n<?php\n\n/**\n * Setup an extended post query class.\n * Used for post_type_name\n *\n * @package WordPress\n * @subpackage WP_Lemon\\Child\n */\n\nnamespace WP_Lemon\\Child\\Classes;\n\nuse WP_Lemon\\Classes\\LemonPost;\nuse Timber\\Timber;\n\nclass post_type_name extends LemonPost\n{\n   private mixed $_example = null;\n\n   public function get_example(): array|null\n   {\n      if (!is_null($this->_example)) {\n         return $this->_example;\n      }\n\n      return $this->_example;\n   }\n}\n\n"})}),"\n",(0,o.jsx)(t.h3,{id:"add-to-classmap",children:"Add to classmap"}),"\n",(0,o.jsxs)(t.p,{children:["After you've created this file you'll need to add it to the classmap, this needs to be done so that Timber knows where to find the new class.\nYou should do this inside the ",(0,o.jsx)(t.code,{children:"/library"})," directory.\nIn essence you could place it anywhere like in the ",(0,o.jsx)(t.code,{children:"hooks.php"})," file but we prever to place it in the ",(0,o.jsx)(t.code,{children:"child-setup.php"})," file since it's part of the setup process.\nThis will look something like this:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"\nadd_filter(\n\t'timber/post/classmap',\n\tfunction ($classmap) {\n\t\t$custom_classmap = [\n\t\t\t'person'         => Person::class,\n\t\t\t'publication'    => Publication::class,\n\t\t\t'project'        => Project::class,\n\t\t\t'lectorate'      => Lectorate::class,\n\t\t\t'news'           => News::class,\n\t\t\t'post-education' => PostEduction::class,\n\t\t\t'education'      => Education::class,\n\t\t];\n\n\t\treturn array_merge($classmap, $custom_classmap);\n\t}\n);\n\n"})}),"\n",(0,o.jsx)(t.h3,{id:"include-the-file",children:"Include the file"}),"\n",(0,o.jsxs)(t.p,{children:["Then last but not least you'll have to include the file so that it gets loaded when the theme is loaded.\nNavigate to the ",(0,o.jsx)(t.code,{children:"functions.php"})," file in the root of your theme.\nHere you can include the file like this:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"\nfunction parent_loaded()\n{\n\t$autoloader = new Autoloader();\n\t$autoloader->child(['models']); // order in which our folders get autoloaded.\n\t$autoloader->child_blocks();\n\n\t$includes = [\n\t\t'library/classes/class-child-site.php',\n\t\t'library/classes/class-object-news.php',\n\t\t'library/classes/class-object-<post_type_name>.php',\n\t\t'library/child-setup.php',\n\t\t'library/hooks.php',\n\t];\n\n\tforeach ($includes as $file) {\n\t\t$filepath = locate_template($file);\n\t\tif (!$filepath) {\n\t\t\t/* translators: %s: file to include */\n\t\t\tBulldozer::frontend_error(sprintf(__('Error locating %s for inclusion', 'wp-lemon'), $file));\n\t\t}\n\t\trequire_once $filepath;\n\t}\n\tunset($file, $filepath);\n\n\tnew WP_Lemon_Child_Site();\n}\nadd_action('parent_loaded', __NAMESPACE__ . '\\\\parent_loaded');\n\n"})}),"\n",(0,o.jsx)(t.h2,{id:"examples",children:"Examples"}),"\n",(0,o.jsx)(t.p,{children:"Below you can see a couple simple examples that you could use in your extended post object,\nand also how you can then use it in your front-end."}),"\n",(0,o.jsx)(t.h3,{id:"example-1",children:"Example 1"}),"\n",(0,o.jsx)(t.p,{children:"Below you'll find a simple example of a function that calculates the reading time of a post."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"\n/**\n * Calculate the reading time of the post.\n *\n * @return string\n */\npublic function reading_time(): string\n{\n\t$words_per_minute = 228;\n\n\t$words = str_word_count(wp_strip_all_tags($this->content()));\n\n\tif ($words / $words_per_minute < 1) {\n\t\treturn __('< 1 minute', 'wp-lemon-child');\n\t}\n\n\t$minutes = round($words / $words_per_minute);\n\n\t/* translators: %s: Time duration in minute or minutes. */\n\treturn sprintf(_n('%s minute', '%s minutes', $minutes, 'wp-lemon-child'), (int) $minutes);\n}\n\n"})}),"\n",(0,o.jsx)(t.p,{children:"This newly created function can be used in your single page for example like this:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-twig",children:'{% block content %}\n\t<header class="section">\n\t\t<div class="entry__header-top">\n\t\t\t<div class="readingtime">\n\t\t\t\t<i class="icon-clock-o"></i>\n\t\t\t\t{{ post.reading_time }}\n\t\t\t</div>\n\t\t</div>\n\t\t<h1>{{ post.title }}</h1>\n\t</header>\n\t{{ post.content }}\n{% endblock %}\n'})}),"\n",(0,o.jsx)(t.h3,{id:"example-2",children:"Example 2"}),"\n",(0,o.jsx)(t.p,{children:"In this example the name of a person needed to be formatted in a certain way, ofc we could've also done it in the front-end\nbut we believe that it's best to let the back-end handle most of the logic."}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"/**\n * Fetch the full name of the person, including title.\n *\n * @return string\n */\npublic function get_full_name(): string\n{\n\tif (!is_null($this->_full_name)) {\n\t\treturn $this->_full_name;\n\t}\n\t$name = null;\n\n\t$names_group = $this->meta('names');\n\n\t$name .= $names_group['title'] ? $names_group['title'] . ' ' : '';\n\t$name .= $names_group['first_name'] ? $names_group['first_name'] . ' ' : '';\n\t$name .= $names_group['last_name'] ? $names_group['last_name'] : '';\n\n\t$this->_full_name = $name;\n\n\treturn $this->_full_name;\n}\n"})}),"\n",(0,o.jsx)(t.h2,{id:"wp-lemon-queries",children:"Wp-lemon queries"}),"\n",(0,o.jsxs)(t.p,{children:["In wp-lemon we've added a set of predefined queries that you can use to fetch posts. You could use these for example in your block context.\nFor more documentation on how to use them within your block context take a look at the ",(0,o.jsx)(t.a,{href:"/blocks/block-controller",children:"block context documentation"}),".\nBelow you can find a list of all the queries that are available in wp-lemon."]}),"\n",(0,o.jsxs)(t.table,{children:[(0,o.jsx)(t.thead,{children:(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.th,{children:"Function"}),(0,o.jsx)(t.th,{children:"Description"})]})}),(0,o.jsxs)(t.tbody,{children:[(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"latest_items_query"})}),(0,o.jsx)(t.td,{children:"Retrieves the latest posts of a specific type, optionally filtered by taxonomy and terms."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"other_items_query"})}),(0,o.jsx)(t.td,{children:"Fetches posts of a specific type, excluding a given post, optionally filtered by taxonomy and terms."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"specific_items_query"})}),(0,o.jsx)(t.td,{children:"Retrieves specific posts by their IDs and type."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"archive_query"})}),(0,o.jsx)(t.td,{children:"Fetches a set of posts of a specific type for archive display, supporting pagination."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"get_total_posts"})}),(0,o.jsx)(t.td,{children:'Calculates the total number of posts available for an AJAX "load more" functionality.'})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"adjacent_post_info"})}),(0,o.jsx)(t.td,{children:"Gets information about the next or previous post, or returns the first/last post if unavailable."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"next_post_info"})}),(0,o.jsx)(t.td,{children:"Returns information about the next post or the first post if no next post exists."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"previous_post_info"})}),(0,o.jsx)(t.td,{children:"Returns information about the previous post or the last post if no previous post exists."})]}),(0,o.jsxs)(t.tr,{children:[(0,o.jsx)(t.td,{children:(0,o.jsx)(t.code,{children:"taxonomy_post_collection"})}),(0,o.jsx)(t.td,{children:"Retrieves a collection of posts organized by category, based on a taxonomy and post type."})]})]})]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453(e,t,n){n.d(t,{R:()=>l,x:()=>r});var s=n(6540);const o={},i=s.createContext(o);function l(e){const t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);