"use strict";(globalThis.webpackChunkwp_lemon_docs=globalThis.webpackChunkwp_lemon_docs||[]).push([[3682],{3492(e,t,n){n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"blocks/block-controller","title":"Block controller","description":"Documentation on the block controller layer.","source":"@site/docs/blocks/block-controller.mdx","sourceDirName":"blocks","slug":"/blocks/block-controller","permalink":"/wp-lemon-docs/blocks/block-controller","draft":false,"unlisted":false,"editUrl":"https://github.com/Studio-Lemon/wp-lemon-docs/tree/master/docs/blocks/block-controller.mdx","tags":[],"version":"current","frontMatter":{"title":"Block controller","description":"Documentation on the block controller layer."},"sidebar":"docsSidebar","previous":{"title":"Block declaration","permalink":"/wp-lemon-docs/blocks/block-declaration"},"next":{"title":"Block view","permalink":"/wp-lemon-docs/blocks/block-view"}}');var s=n(4848),i=n(8453);const l={title:"Block controller",description:"Documentation on the block controller layer."},c=void 0,r={},a=[{value:"Anatomy of a block controller",id:"anatomy-of-a-block-controller",level:2},{value:"Block content",id:"block-content",level:2},{value:"InnerBlocks",id:"innerblocks",level:3},{value:"Adding ACF fields to the block",id:"adding-acf-fields-to-the-block",level:3},{value:"Extending the block context",id:"extending-the-block-context",level:2},{value:"Block that displays an x amount of (custom)posts",id:"block-that-displays-an-x-amount-of-customposts",level:3},{value:"Block that displays a post archive with load more button",id:"block-that-displays-a-post-archive-with-load-more-button",level:3},{value:"Block with custom assets",id:"block-with-custom-assets",level:3},{value:"Block that needs conditional modifier classes",id:"block-that-needs-conditional-modifier-classes",level:3},{value:"Wp-lemon queries",id:"wp-lemon-queries",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"The block controller is where you'll probably spend most time while developing a custom block.\nThis is where you process any dynamic data and control how your block behaves based on input from the editor.\nThe idea is to put all of our logic in here, so that when you're working in the view layer, you only have to focus on creating a beautiful front end."}),"\n",(0,s.jsx)(t.h2,{id:"anatomy-of-a-block-controller",children:"Anatomy of a block controller"}),"\n",(0,s.jsx)(t.p,{children:"In the block controller you will find 2 methods you can use to expand your block:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"block_context()"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.code,{children:"add_fields()"})}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"The block_context() function is used to query the data from the database and add it to the block context."}),"\n",(0,s.jsx)(t.h2,{id:"block-content",children:"Block content"}),"\n",(0,s.jsx)(t.p,{children:"There are two main ways to add content to your block."}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"InnerBlocks"}),"\n",(0,s.jsx)(t.li,{children:"ACF fields"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"We prefer InnerBlocks over ACF fields because it uses native WordPress functionality.\nThe reason you might want to use ACF fields is for repeater fields like slides or testimonials.\nBelow we'll show you how to use both methods."}),"\n",(0,s.jsx)(t.h3,{id:"innerblocks",children:"InnerBlocks"}),"\n",(0,s.jsxs)(t.p,{children:["InnerBlocks are blocks within blocks. This way you can create complex blocks with multiple child blocks.\nThis gives the user a lot of control over the layout of the block.\nTo learn how to use InnerBlocks, take a look at the ",(0,s.jsx)(t.a,{href:"/blocks/innerblocks",children:"InnerBlocks documentation"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"adding-acf-fields-to-the-block",children:"Adding ACF fields to the block"}),"\n",(0,s.jsxs)(t.p,{children:["You can add any type of ACF field to the block. To find out all the possibilities take a look at the ",(0,s.jsx)(t.a,{href:"https://github.com/StoutLogic/acf-builder/wiki/field-types",children:"ACF documentation"}),".\nHere you'll find all the different field types and how to use them.\nBelow is a simple example of what your add_fields() function could look like."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-php",children:"public function add_fields(): object\n{\n   $this->registered_fields\n      ->addRepeater(\n         'slides',\n         [\n            'layout' => 'block',\n            'min'    => 1,\n            'max'    => 4,\n         ]\n      )\n      ->addImage('image', [\n         'label' => 'Image',\n         'return_format' => 'id',\n         'preview_size' => 'medium',\n      ])\n      ->addText('caption', [\n         'label'     => 'Bijschrift',\n      ])\n      ->endRepeater();\n   return $this->registered_fields;\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["To learn how to use these fields in your block view, take a look at the ",(0,s.jsx)(t.a,{href:"/blocks/block-view",children:"block view documentation"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"extending-the-block-context",children:"Extending the block context"}),"\n",(0,s.jsxs)(t.p,{children:["Every block is different but we will give some common examples on how to expand your block. Please also take a look at the ",(0,s.jsx)(t.a,{href:"https://levdbas.github.io/Bulldozer/#/reference/highground-bulldozer-blockrendererv2",children:"BlockRenderer documentation"})," for more functions you can use in your block context."]}),"\n",(0,s.jsx)(t.h3,{id:"block-that-displays-an-x-amount-of-customposts",children:"Block that displays an x amount of (custom)posts"}),"\n",(0,s.jsxs)(t.p,{children:["Take a look at the ",(0,s.jsx)(t.code,{children:"news-recent.php"})," block in the parent theme. You will find a method block_context().\nWhen going through these lines you will find several notable things."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-php",metastring:"lineNumbers=true",children:"public function block_context($context): array\n{\n   $amount = $this->get_field('amount') ? $this->get_field('amount') : 3;\n   $items = latest_items_query('news', $amount);\n\n      if ($items->found_posts == 0) {\n         self::add_notification(__(\"You haven't added any news yet, so this block will be empty.\", \"wp-lemon\"), 'warning');\n      }\n\n      $args = [\n         'items'            => $items,\n         'card_type'        => 'news',\n         'holder_classes'   => 'col-12 col-md-6 col-lg-4',\n         'InnerBlocks'      => self::create_inner_blocks(false, $template, 'crd__content'),\n      ];\n\n      return array_merge($context, $args);\n}\n"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"wp-lemon comes with a set of predefined queries. Here we use latest_items_query() to get the latest posts of a specific posttype"}),"\n",(0,s.jsx)(t.li,{children:"We have a card_type variable that defines what card type will be loaded."}),"\n",(0,s.jsx)(t.li,{children:"We have a add_notification method that will setup a notification inside the block when previewed in the backend."}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"block-that-displays-a-post-archive-with-load-more-button",children:"Block that displays a post archive with load more button"}),"\n",(0,s.jsxs)(t.p,{children:["Take a look at the ",(0,s.jsx)(t.code,{children:"news-overview.php"})," block in the parent theme. You will again find a method block_context() that will query the data from the database and add it to the block context."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-php",metastring:"lineNumbers=true",children:"public function block_context($context): array\n{\n   $items = archive_query('news', 6); // query the news posttype\n   $count = get_total_posts('news', count($items)); // get a count array that feeds information to the postholder.\n   $show_filter = false;\n   $terms = [];\n\n   if ($this->get_field('show_filter') == true) {\n      $show_filter = true;\n      $terms = get_terms('category', array('hide_empty' => true));\n   }\n\n   // add notification when no posts are found.\n   if ($items->found_posts == 0) {\n      self::add_notification(__('You haven\\'t added any news yet, so this block will be empty.', 'wp-lemon'), 'warning');\n   }\n\n   $args = [\n      'items'          => $items,\n      'nav'            => true,\n      'count'          => $count,\n      'post_type'      => 'news',\n      'card_type'      => 'news',\n      'show_filter'    => $show_filter,\n      'terms'          => $terms,\n      'holder_classes' => 'col-12 col-md-6 col-lg-4',\n      'InnerBlocks'    => self::create_inner_blocks(false, $template, 'crd__content'),\n   ];\n\n   return array_merge($context, $args);\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The linked ",(0,s.jsx)(t.code,{children:"blocks/news-overview.twig"})," file will include ",(0,s.jsx)(t.code,{children:"components/archive-loop.twig"})," that will display the initial posts and setup everything for receiving new posts via an ajax call."]}),"\n",(0,s.jsx)(t.p,{children:"When reusing above code make sure to:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"set the post type correctly"}),"\n",(0,s.jsx)(t.li,{children:"create a new card twig file"}),"\n",(0,s.jsxs)(t.li,{children:["include the ",(0,s.jsx)(t.code,{children:"components/archive-loop.twig"})," inside your twig file that is linked to your block."]}),"\n",(0,s.jsx)(t.li,{children:"Update the notice to inform the administrator/editors of the website when no posts are found of the posttype you want to query."}),"\n",(0,s.jsx)(t.li,{children:"include the right functions in your file like so"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-php",metastring:"lineNumbers=true",children:"namespace WP_Lemon\\Child\\Blocks;\n\nuse HighGround\\Bulldozer\\BlockRenderer;\n\n++ use function WP_Lemon\\API\\archive_query;\n++ use function WP_Lemon\\API\\get_total_posts;\n"})}),"\n",(0,s.jsx)(t.h3,{id:"block-with-custom-assets",children:"Block with custom assets"}),"\n",(0,s.jsxs)(t.p,{children:["You might want to add a specific asset to the blocks context as it is only used by this specific block. You can use the ",(0,s.jsx)(t.code,{children:"asset()"})," helper function for that."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-php",metastring:"lineNumbers=true",children:"public function block_context($context): array\n{\n      $args = [\n         'sphere'     => asset('images/sphere.svg')->contents(),\n         'banner_uri' => asset('images/banner.png')->exists() ? asset('images/banner.png')->uri() : false,\n      ];\n\n      return array_merge($context, $args);\n}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"block-that-needs-conditional-modifier-classes",children:"Block that needs conditional modifier classes"}),"\n",(0,s.jsxs)(t.p,{children:["You might want to add conditional classes based on a field setting. This is where ",(0,s.jsx)(t.code,{children:"$this->add_modifier_class('yourmodifier');"})," comes in.\nThis method adds a BEM modifier class to your block. An example:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-php",metastring:"lineNumbers=true",children:"public function block_context($context): array\n{\n   \n   if (true == $this->get_field('show_pagination')) {\n         $context['show_pagination'] = true;\n         $this->add_modifier_class('has-pagination');\n   }\n   \n   return $context;\n}\n"})}),"\n",(0,s.jsx)(t.p,{children:"will result in"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-twig",metastring:"lineNumbers=true",children:'<div class="acf-block slider slider--has-pagination" id="block_5f8ffdc0349e1">\n...\n</div>\n'})}),"\n",(0,s.jsx)(t.h2,{id:"wp-lemon-queries",children:"Wp-lemon queries"}),"\n",(0,s.jsx)(t.p,{children:"When you want to use post objects within your custom block you can use the following queries in your block context:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Function"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"latest_items_query"})}),(0,s.jsx)(t.td,{children:"Retrieves the latest posts of a specific type, optionally filtered by taxonomy and terms."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"other_items_query"})}),(0,s.jsx)(t.td,{children:"Fetches posts of a specific type, excluding a given post, optionally filtered by taxonomy and terms."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"specific_items_query"})}),(0,s.jsx)(t.td,{children:"Retrieves specific posts by their IDs and type."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"archive_query"})}),(0,s.jsx)(t.td,{children:"Fetches a set of posts of a specific type for archive display, supporting pagination."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"get_total_posts"})}),(0,s.jsx)(t.td,{children:'Calculates the total number of posts available for an AJAX "load more" functionality.'})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"adjacent_post_info"})}),(0,s.jsx)(t.td,{children:"Gets information about the next or previous post, or returns the first/last post if unavailable."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"next_post_info"})}),(0,s.jsx)(t.td,{children:"Returns information about the next post or the first post if no next post exists."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"previous_post_info"})}),(0,s.jsx)(t.td,{children:"Returns information about the previous post or the last post if no previous post exists."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"taxonomy_post_collection"})}),(0,s.jsx)(t.td,{children:"Retrieves a collection of posts organized by category, based on a taxonomy and post type."})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453(e,t,n){n.d(t,{R:()=>l,x:()=>c});var o=n(6540);const s={},i=o.createContext(s);function l(e){const t=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),o.createElement(i.Provider,{value:t},e.children)}}}]);