---
title: Add blocks
description: How to add new blocks.
---

Sometimes you want to expand the capabilities of wp-lemon. Sometimes custom blocks are required.

## Register block

in you custom theme in `library/blocks` you'll find `_example.php`. What you want to do is duplicate this file. After that you want to overwrite the
`Example_Block` class and activate the class on the bottom of this file by uncommenting it. After that you can update the name, title, icon data. This file automatically gets loaded.

```php title=library/blocks/_example.php lineNumbers=true
namespace WP_Lemon\Child\Blocks;

use HighGround\Bulldozer\BlockRenderer;

/**
 * Example block that can be copied for making extra blocks.
 * Change the Example_Block class on rule 11 and below the class and uncomment the class call.
 * Don't include the render callback in the block register since we add that in our main BlockRenderer abstract class.
 *
 * Follow the API standard of https://www.advancedcustomfields.com/resources/acf_register_block_type/
 */
class Example_Block extends BlockRenderer
{
   public function block_register(): array
   {
       $block = [
         'name' => 'example', // searches for resources/views/blocks/example.twig
         'title' => __('Example', 'wp-lemon'),
         'description' => __('Show a banner with a still image in the background.', 'wp-lemon'),
         'category' => 'wp-lemon-blocks', // default custom category or add new ones.
         'icon' => 'desktop', // regular dashicons without the 'dashicon-' prefix
         'keywords' => ['example', 'tag2', 'tag3'], // keywords to search blocks for.
         'supports' => [
            'align' => false
         ]
      ];
      return $block;
   }

   /**
    * Extend the base context of our block.
    * With this function we can add for example a query or
    * other custom content.
    *
    * @param array   $block      Holds the block data
    * @return array  $context    Returns the array with the extra content that merges into the original block context.
    */
   public function block_context($context): array
   {

      return $context;
   }
}
/**
 * Enable the class
 */
//new Example_Block();

```

## Create twig file

After registering the block you need to create a twig file to render the view of the block. in `resources/views/blocks/` you will find `example.twig`. You want to duplicate this file and make it have the same name as set in your php file.

## Test block

You can now add the block to a page and see if it works. Common reasons why the block doesn't work:

- You forgot to uncomment the block register call in your PHP file.
- You didn't change the classnames on all places.

Once verified that the block is working you can continue developing your new block.

## Develop the new block

Every block is different but we will give some common examples on how to expand your block.

### Block that displays an x amount of (custom)posts

Take a look at the `news-recent.php` block in the parent theme. You will find a method block_context().
When going through these lines you will find several notable things.

```php lineNumbers=true
 public function block_context($context): array
   {
      $amount = get_field('amount') ? get_field('amount') : 3;
      $items = latest_items_query('news', $amount);
      $context['items'] = $items;
      $context['card_type'] = 'news';
      $context['holder_classes'] = 'col-12 col-md-6 col-lg-4';
      $message = __("You haven't added any news yet, so this block will be empty.", "wp-lemon");

      if ($items->found_posts == 0) {
         parent::compose_notification($message, 'warning');
      }

      return $context;
   }
```

- wp-lemon comes with a set of predefined queries. Here we use latest_items_query() to get the lastest posts of a specific posttype
- We have a card_type variable that defines what card type will be loaded.
- We have a compose_notification method that will setup a notification inside the block when previewed in the backend.

### Block that displays a post archive with load more button

Take a look at the `news-overview.php` block in the parent theme. You will again find a method block_context() that will query the data from the database and add it to the block context.

```php lineNumbers=true
   public function block_context($context): array
   {
      $items = archive_query('news', 6); // query the news posttype
      $context['items'] = $items;
      $context['nav'] = true; // show nav
      $context['count'] = get_total_posts('news', count($items)); // get a count array that feeds information to the postholder.
      $context['post_type'] = 'news'; // sets post type for the ajax calls.
      $context['card_type'] = 'news'; // sets the twig partial to render the actual posts in the loop.
      $context['holder_classes'] = 'col-12 col-md-6 col-lg-4'; // holder classes around the cards in the loop.

      if (isset($this->fields['show_filter']) && $this->fields['show_filter'] == true) {
         $context['show_filter'] = true;
         $context['terms'] = get_terms('category', array('hide_empty' => true));
      }

      // add notification when no posts are found.
      if ($items->found_posts == 0) {
         parent::compose_notification(__('You haven\'t added any news yet, so this block will be empty.', 'wp-lemon'), 'warning');
      }

      return $context;
   }
```

The linked `blocks/news-overview.twig` file will include `components/archive-loop.twig` that will display the initial posts and setup everything for receiving new posts via an ajax call.

When reusing above code make sure to:

- set the post type correctly
- create a new card twig file
- include the `components/archive-loop.twig` inside your twig file that is linked to your block.
- Update the notice to inform the administrator/editors of the website when no posts are found of the posttype you want to query.
- include the right functions in your file like so

```php lineNumbers=true
namespace WP_Lemon\Child\Blocks;

use HighGround\Bulldozer\BlockRenderer;

++ use function WP_Lemon\Controllers\archive_query;
++ use function WP_Lemon\Controllers\get_total_posts;
```

### Block with custom acf fields

to do

### Block with custom assets

to do

### Block that needs conditional modifier classes

to do
